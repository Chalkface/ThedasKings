###########################################
#
# Grey Warden Decisions
#
###########################################
# Written by Daniel Luckhurst
###########################################



decisions = {

	expel_the_fereldan_wardens = {
		potential = {
			ai = no
			OR = {
				religion = catholic
				religion = cathar
				religion = fraticelli
				religion = waldensian
				religion = lollard
			}
			is_heretic = no
			higher_tier_than = DUKE
			independent = yes
			is_title_active = d_fereldan_wardens
			NOT = { has_character_modifier = expelled_grey_wardens }
			
			any_realm_province = {
				any_province_lord = {
					d_fereldan_wardens = {
						holder_scope = {
							OR = {
								character = PREVPREV
								is_vassal_or_below = PREVPREV
							}
						}
					}
				}
			}
			
			has_dlc = "Sons of Abraham"
		}
		
		allow = {
			piety = 1000
		}
		
		effect = {
			piety = -1000
			
			hidden_tooltip = {
				d_fereldan_wardens = {
					holder_scope = {
						character_event = {
							id = #
						}
					}
				}
				add_character_modifier = {
					name = expelled_grey_Wardens
					duration = -1
					inherit = yes
				}
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	expel_the_orlaisian_wardens = {
		potential = {
			ai = no
			OR = {
				culture = orlaisian
			}

			higher_tier_than = DUKE
			independent = yes
			is_title_active = d_orlaisian_wardens
			NOT = { has_character_modifier = expelled_orlaisian_wardens }
			
			any_realm_province = {
				any_province_lord = {
					d_orlaisian_wardens = {
						holder_scope = {
							OR = {
								character = PREVPREV
								is_vassal_or_below = PREVPREV
							}
						}
					}
				}
			}
			
			has_dlc = "Sons of Abraham"
		}
		
		allow = {
			piety = 1000
		}
		
		effect = {
			piety = -1000
			
			religion_authority = {
				modifier = grey_wardens_expelled
				years = 20
			}
			
			hidden_tooltip = {
				d_orlaisian_wardens = {
					holder_scope = {
						character_event = {
							id = #
						}
					}
				}
				add_character_modifier = {
					name = expelled_orlaisian_wardens
					duration = -1
					inherit = yes
				}
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	
	vassalize_knights_templar = {
		is_high_prio = yes
		
		potential = {
			OR = {
				religion = catholic
				religion = cathar
				religion = fraticelli
				religion = waldensian
				religion = lollard
			}
			is_heretic = no
			
			is_title_active = d_knights_templar
			
			has_landed_title = k_jerusalem
			
			d_knights_templar = {
				holder_scope = {
					liege = {
						NOT = { character = ROOT }
					}
				}
			}
			
			has_dlc = "Sons of Abraham"
		}
		
		allow = {
			wealth = 500
		}
		
		effect = {
			wealth = -500
			
			hidden_tooltip = {
				d_knights_templar = {
					holder_scope = {
						wealth = 500
						character_event = {
							id = SoA.1015
						}
					}
				}
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	vassalize_knights_hospitaler = {
		is_high_prio = yes
		
		potential = {
			OR = {
				religion = catholic
				religion = cathar
				religion = fraticelli
				religion = waldensian
				religion = lollard
			}
			is_heretic = no
			
			is_title_active = d_knights_hospitaler
			
			has_landed_title = k_jerusalem
			
			d_knights_hospitaler = {
				holder_scope = {
					liege = {
						NOT = { character = ROOT }
					}
				}
			}
			
			has_dlc = "Sons of Abraham"
		}
		
		allow = {
			wealth = 500
		}
		
		effect = {
			wealth = -500
			
			hidden_tooltip = {
				d_knights_hospitaler = {
					holder_scope = {
						wealth = 500
						character_event = {
							id = SoA.1115
						}
					}
				}
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	
	
	donate_money_to_knights_calatrava = {
		potential = {
			OR = {
				religion = catholic
				religion = cathar
				religion = fraticelli
				religion = waldensian
				religion = lollard
			}
			is_heretic = no
			is_title_active = d_knights_calatrava

			OR = {
				AND = {
					NOT = { is_title_active = d_knights_hospitaler }
					NOT = { is_title_active = d_knights_templar }
					NOT = { is_title_active = d_teutonic_order }
				}
				AND = {
					NOT = { is_title_active = d_knights_templar }
					NOT = { is_title_active = d_knights_hospitaler }
					NOT = { culture_group = north_germanic }
					NOT = { culture_group = central_germanic }
					NOT = { culture_group = magyar }
					NOT = { culture_group = south_slavic }
					NOT = { culture_group = west_slavic }
				}
				culture_group = iberian
				culture_group = west_african
				culture = maghreb_arabic
				culture = occitan
			}
			
			has_dlc = "Sons of Abraham"
		}
		
		allow = {
			wealth = 300
		}
		
		effect = {
			if = {
				limit = { 
					NOT = { has_character_modifier = donated_to_holy_order }
				}
				add_character_modifier = {
					name = donated_to_holy_order
					duration = -1
				}
			}
			
			hidden_tooltip = {
				d_knights_calatrava = {
					holder_scope = {
						character_event = {
							id = SoA.2740
						}
					}
				}
			}
			
			wealth = -300
			piety = 300
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					piety = 1000
					NOT = { wealth = 1000 }
					AND = {
						NOT = { controls_religion = catholic }
						NOT = { controls_religion = fraticelli }
						NOT = { controls_religion = waldensian }
						NOT = { controls_religion = lollard }
					}
				}
			}
			modifier = {
				factor = 0.002 # Slow it down
			}
		}
	}
	
}
